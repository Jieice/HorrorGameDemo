[gd_scene load_steps=3 format=3 uid="uid://b1xw78wradbhl"]

[ext_resource type="Texture2D" uid="uid://c7qnohbj4oe73" path="res://Assets/Textures/Icons/Black-Icon/Gear.svg" id="1_ixnqr"]

[sub_resource type="GDScript" id="GDScript_e0i6b"]
script/source = "extends TextureButton

# 预加载设置UI场景
const SETTINGS_UI_SCENE = preload(\"res://Scene/UI/SettingsUI.tscn\")
var settings_ui = null

func _ready():
	# 检查当前场景是否为主菜单
	var current_scene = get_tree().current_scene
	if current_scene.name == \"main_menu\" or current_scene.scene_file_path == \"res://Scene/main_menu.tscn\":
		# 如果是主菜单，则隐藏设置按钮
		hide()
	else:
		# 如果不是主菜单，则显示设置按钮
		show()
		
		# 连接按钮信号
		pressed.connect(_on_settings_button_pressed)
	
	# 预加载设置UI - 移到按钮点击时再创建，避免过早创建导致问题

# 设置按钮点击事件
func _on_settings_button_pressed():
	print(\"设置按钮被点击\")
	
	# 检查是否已存在设置UI实例
	var existing_settings = get_tree().root.get_node_or_null(\"SettingsUI\")
	if existing_settings:
		# 如果已存在，则先移除旧实例
		existing_settings.queue_free()
	
	# 创建新的设置UI实例
	settings_ui = SETTINGS_UI_SCENE.instantiate()
	settings_ui.name = \"SettingsUI\" # 设置唯一名称以便检查
	settings_ui.z_index = 100
	
	# 设置处理模式为ALWAYS，确保在游戏暂停时仍能交互
	settings_ui.process_mode = Node.PROCESS_MODE_ALWAYS
	# 设置鼠标过滤模式，确保能接收所有输入
	settings_ui.mouse_filter = Control.MOUSE_FILTER_STOP
	
	# 添加到场景树
	get_tree().root.add_child(settings_ui)
	
	# 确保所有按钮信号正确连接
	if settings_ui.has_method(\"_connect_signals\"):
		settings_ui.call(\"_connect_signals\")
	
	# 显示设置UI
	settings_ui.show()
	
	# 确保鼠标可见
	Input.mouse_mode = Input.MOUSE_MODE_VISIBLE
	
	# 暂停游戏（如果在游戏场景中）
	var current_scene = get_tree().current_scene
	if current_scene.name != \"main_menu\" and current_scene.scene_file_path != \"res://Scene/main_menu.tscn\":
		get_tree().paused = true
"

[node name="CornerSettingsButton" type="CanvasLayer"]

[node name="SettingsButton" type="TextureButton" parent="."]
anchors_preset = 3
anchor_left = 1.0
anchor_top = 1.0
anchor_right = 1.0
anchor_bottom = 1.0
offset_left = -60.0
offset_top = -60.0
offset_right = -20.0
offset_bottom = -20.0
grow_horizontal = 0
grow_vertical = 0
texture_normal = ExtResource("1_ixnqr")
ignore_texture_size = true
stretch_mode = 5
script = SubResource("GDScript_e0i6b")
