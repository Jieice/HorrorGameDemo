# 任务提示系统使用说明

## 概述

这个任务提示系统是为Godot恐怖游戏开发的一套完整任务管理解决方案，包括任务管理器、任务提示UI以及与游戏对象的集成。

## 系统组件

### 1. TaskManager.gd
任务管理器，负责处理所有任务相关的逻辑：
- 添加、更新、完成任务
- 管理任务目标和进度
- 发送任务状态变化信号

### 2. TaskHintUI.gd
任务提示UI，负责显示任务信息：
- 显示当前任务列表
- 显示任务进度
- 提供新任务和任务完成通知
- 支持显示/隐藏切换

### 3. UIManager.gd
全局UI管理器，集成了任务系统：
- 初始化任务管理器和任务提示UI
- 提供全局访问任务系统的接口
- 管理UI样式和效果

### 4. 集成组件
以下组件已更新，支持任务触发：
- InteractableObject.gd - 可交互对象
- NPC.gd - 非玩家角色
- ActionTrigger.gd - 动作触发器

## 使用方法

### 1. 基本设置

确保UIManager已添加到项目设置中的自动加载列表：
1. 打开 Project -> Project Settings
2. 选择 AutoLoad 标签
3. 添加 UIManager.gd，名称为 "UIManager"

### 2. 添加任务

```gdscript
# 添加新任务
UIManager.add_task("task_id", "任务标题", "任务描述", true)  # true表示主线任务

# 添加任务目标
UIManager.add_task_objective("task_id", "objective_id", "目标描述")

# 更新任务进度
UIManager.update_task_progress("task_id", 50, 100)  # 50/100的进度

# 完成任务目标
UIManager.complete_task_objective("task_id", "objective_id")

# 完成任务
UIManager.complete_task("task_id")
```

### 3. 显示/隐藏任务提示

```gdscript
# 切换任务提示显示
UIManager.toggle_task_hint()

# 显示任务提示
UIManager.show_task_hint()

# 隐藏任务提示
UIManager.hide_task_hint()
```

### 4. 在游戏对象中设置任务触发

#### InteractableObject
```gdscript
# 在Inspector中设置
object_name = "神秘钥匙"
trigger_task_id = "find_key"  # 触发的任务ID
task_description = "找到神秘钥匙"  # 任务描述
```

#### NPC
```gdscript
# 在Inspector中设置
npc_name = "神秘人"
dialogue_lines = ["你好，勇敢的探险者。", "我有一个任务给你。", "请找到那把神秘的钥匙。"]
trigger_task_id = "talk_to_stranger"  # 触发的任务ID
task_description = "与神秘人交谈"  # 任务描述
```

#### ActionTrigger
```gdscript
# 在Inspector中设置
action_type = OPEN_DOOR
prompt_text = "按 E 打开门"
complete_task_id = "find_key"  # 完成的任务ID
```

## 示例场景

查看 `Scene/TaskSystemDemo.tscn` 了解如何使用任务系统。该场景包含：
- 任务管理器和任务提示UI
- 可交互对象（神秘钥匙）
- NPC（神秘人）
- 动作触发器（门）

## 自定义扩展

### 1. 添加新的任务类型

在TaskManager.gd中，可以扩展任务类型：

```gdscript
enum TaskType {
	MAIN,      # 主线任务
	SIDE,      # 支线任务
	HIDDEN,    # 隐藏任务
	DAILY      # 每日任务
}
```

### 2. 自定义任务UI

修改TaskHintUI.gd中的UI布局和样式，或创建新的UI场景。

### 3. 添加任务奖励系统

在TaskManager.gd中添加奖励处理逻辑：

```gdscript
func complete_task(task_id: String) -> void:
	# 现有代码...
	
	# 添加奖励处理
	var task = tasks[task_id]
	if task.has("rewards"):
		_apply_rewards(task.rewards)

func _apply_rewards(rewards: Dictionary) -> void:
	# 处理经验值、物品、金钱等奖励
	pass
```

## 注意事项

1. 确保玩家节点添加了"player"组，以便交互检测
2. 确保项目中有"interact"输入映射，默认为E键
3. 任务ID应该是唯一的，避免冲突
4. 在场景切换时，考虑是否需要保存任务状态

## 故障排除

### 任务提示不显示
- 检查UIManager是否正确添加到自动加载
- 确认TaskHintUI场景正确加载
- 检查任务是否正确添加

### 交互不触发任务
- 确认玩家节点有"player"组
- 检查"interact"输入映射是否正确设置
- 确认交互对象的触发任务ID是否正确

### 任务进度不更新
- 检查任务ID是否正确
- 确认任务管理器是否正确初始化
- 检查信号连接是否正确